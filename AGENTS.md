# AGENT.md

이 문서는 이커머스 서비스 코드베이스에서 작업할 때의 기준과 규칙을 정리한다.
시니어 백엔드 개발자 관점에서 도메인 주도 설계(DDD)를 최우선으로 한다.

## 1. 기술 스택 요약
- Kotlin 2.2.x, Spring Boot 4.x, Spring MVC
- Spring Security + JWT
- JPA + MySQL
- 빌드/테스트: Gradle, JUnit5

## 2. 핵심 원칙
- 도메인 모델이 비즈니스 규칙의 단일 진실이다.
- 컨트롤러는 얇게 유지하고, 비즈니스 규칙은 도메인/서비스 계층에 둔다.
- 변경 범위를 최소화하고 기존 패키지/명명 규칙을 우선 존중한다.

## 3. 패키지/레이어 규칙
- `src/main/kotlin/small/ecommerce/api`: 컨트롤러, 요청/응답 DTO, 검증
- `src/main/kotlin/small/ecommerce/domain`: 엔티티/값 객체/도메인 서비스/리포지토리 인터페이스
- `src/main/kotlin/small/ecommerce/auth`: 인증/인가, JWT, Security 설정
- `src/main/kotlin/small/ecommerce/common`: 공통 예외, 에러 코드
- 현재 `domain/Brand`처럼 대문자 패키지가 존재하므로, 신규 작업 시에도 기존 구조를 우선 유지한다.
  대규모 리팩토링은 별도 합의가 필요하다.

## 4. DDD 지침
- Aggregate Root는 외부에서 접근 가능한 유일한 엔티티다.
- 불변 값은 Value Object로 모델링한다.
- 도메인 로직은 엔티티/도메인 서비스에 위치시키고, 컨트롤러에 비즈니스 규칙을 두지 않는다.
- 애플리케이션 서비스는 유스케이스 오케스트레이션과 트랜잭션 경계를 담당한다.

## 5. 리포지토리/영속성
- 리포지토리는 도메인 언어로 표현하고 필요한 최소 쿼리만 노출한다.
- 동시성 이슈(재고 차감 등)는 원자적 쿼리나 락 전략으로 보호한다.
- 도메인 객체를 API 응답으로 직접 노출하지 않고 DTO로 변환한다.

## 6. 트랜잭션
- 쓰기 유스케이스: `@Transactional`
- 조회 유스케이스: `@Transactional(readOnly = true)`

## 7. 예외/에러코드
- `BaseException` + `ErrorCode`를 사용한다.
- 에러 메시지와 detail은 한국어로 명확하게 작성한다.
- 예외는 도메인/애플리케이션 경계에서 던지고 컨트롤러는 변환 역할만 수행한다.

## 8. 테스트
- 비즈니스 규칙에 대한 단위 테스트를 우선한다.
- 도메인 서비스/엔티티 단위 테스트 + 컨트롤러 슬라이스 테스트를 기본으로 한다.

## 9. 코드/주석 스타일
- Kotlin idiom을 따른다(data class, sealed class, `require`, `check` 등).
- 널 안정성을 우선하며 `!!` 사용을 지양한다.
- 로그에는 민감정보를 포함하지 않는다.
- 주석은 필요한 경우에만 작성하되 상세하고 한국어로 작성한다. 불필요한 이모지는 포함하지 않는다.

## 10. 작업 흐름
- 작은 단위의 변경으로 쪼개고 테스트 후 리뷰 가능한 상태로 커밋한다.
- 기본 테스트 실행: `./gradlew test`
